# Reference: https://github.com/lima-vm/lima/blob/master/templates/default.yaml

param:
  dataMountPath: /mnt/lima-dev-data

vmType: "vz"

os: "Linux"

disk: "10GiB"

mountType: "virtiofs"
mounts: []

additionalDisks: []

images:
  - location: "https://cloud-images.ubuntu.com/releases/plucky/release-20250701/ubuntu-25.04-server-cloudimg-arm64.img"
    arch: "aarch64"
    digest: "sha256:26d0ac2236f12954923eb35ddfee8fa9fff3eab6111ba84786b98ab3b972c6d8"

user:
  name: dev
  home: /home/dev
  shell: /bin/zsh

ssh:
  localPort: 60022
  forwardAgent: true
  loadDotSSHPubKeys: null

provision:
  - mode: system
    script: |
      sudo apt install zsh git make neovim -y
      sudo chown -R dev "{{.Param.dataMountPath}}"

  # Setup dotfiles
  - mode: user
    script: |
      #!/bin/bash
      set -eux -o pipefail

      DIRECTORY="$HOME/dotfiles"
      
      if [ -d "$DIRECTORY" ]; then
        echo "$DIRECTORY exists, skipping setup"
        exit 1
      fi

      echo "$DIRECTORY does not exist, will setup"

      cd $HOME

      git clone https://github.com/vytautasjc/dotfiles.git
      
      cd $DIRECTORY

      make setup-zsh setup-git

  # Install NVM
  - mode: user
    script: |
      #!/bin/bash
      set -eux -o pipefail

      export DEBIANT_FRONTEND=noninteractive

      # Do not edit shell config files
      PROFILE=/dev/null bash -c 'curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash'